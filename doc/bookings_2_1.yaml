# this is an example of the Uber API
# as a demonstration of an API spec in YAML
swagger: '2.0'
info:
  title: Master Online Reservation
  description: API - Master Online Reservation
  version: "2.1"
# the domain of the service
host: reservasonline.masterasp.com
# array of all schemes that your API supports
schemes:
  - https
# will be prefixed to all paths
basePath: /api
produces:
  - application/json
paths:
  /info:
    get:
      summary: Information
      description: Request to obtain general information of the property like  categories, products, rates, features and so on.
      parameters:
        - name: idProperty
          in: query
          description: Conditions that must meet the response.
          required: true
          type: integer
          format: int32
        - name: lang
          in: query
          type: string
          description: language
      tags:
        - MasterBooking
      responses:
        200:
          description: Return general information of the property including categories, products, rates, features and so on.
          schema:
            $ref: '#/definitions/Info'
        default:
          description: Default error
          schema:
            $ref: '#/definitions/Error'

  /availability:
    get:
      summary: Availability
      description: Request checkin availability for a rate
      parameters:
        - name: idProperty
          in: query
          type: integer
          required: true
          description: Id Property
        - name: idRate
          in: query
          type: integer
          required: true
          description: Id Rate
      tags:
        - MasterBooking
      responses:
        200:
          description: Return checkin array availability for a rate
          schema:
            $ref: '#/definitions/Availability'

  /budgets:
    get:
      summary: Product offeringswith their rates.
      description: Request for obtain the available rates for those budgets, the price and the preference order
      parameters:
        - name: idProperty
          in: query
          type: integer
          required: true
          description: Id Property
        - name: checkin
          in: query
          description: From date
          required: true
          type: string
          format: 'YYYY-MM-DD'
        - name: checkout
          in: query
          description: To date
          required: true
          type: string
          format: 'YYYY-MM-DD'
        - name: flexibleDates
          in: query
          type: boolean
        - name: productIds
          in: query
          description: Comma separated values of product Ids that must meet the query
          type: string
        - name: rateIds
          in: query
          description: Comma separated values of rate Ids that must meet the query
          type: string
        - name: featureIds
          in: query
          description: Comma separated values of feature Ids that must meet the query
          type: string
        - name: ages
          in: query
          description: Comma separated values of the ages of the peeple
          type: string
      tags:
        - MasterBooking
      responses:
        200:
          description: Return Product price
          schema:
            type: array
            items:
              $ref: '#/definitions/Budget'
  /reservationForm:
    get:
      summary: Item
      description: Request All configurable params of a rate
      parameters:
        - name: idProperty
          in: query
          description: Conditions that must meet the response
          required: true
          type: string
        - name: lang
          in: query
          description: Conditions that must meet the response
          required: true
          type: string
        - name: checkin
          in: query
          description: Conditions that must meet the response. From date
          required: true
          type: string
          format: 'YYYY-MM-DD'
        - name: checkout
          in: query
          description: Conditions that must meet the response. To date
          required: true
          type: string
          format: 'YYYY-MM-DD'
        - name: idRate
          in: query
          description: Conditions that must meet the response
          required: true
          type: string
        - name: ages
          in: query
          description: Comma separated values of the ages of the peeple
          type: string
        - name: features
          in: query
          description: |
            Comma separated values of feature Ids that must meet the query
          type: string

      tags:
        - MasterBooking
      responses:
        200:
          description: Return items of a rate
          schema:
            $ref: '#/definitions/BookingForm'

  /bookings:
    post:
      summary: Reservation
      description: Reservation process
      parameters:
        - name: idProperty
          in: query
          description: Conditions that must meet the response
          required: true
          type: string
        - name: booking
          in: body
          required: true
          schema:
            $ref: '#/definitions/Booking'
        - name: agencySecret
          in: query
          type: string
      tags:
        - MasterBooking
      responses:
        200:
          description: Return the state of the booking
          schema:
            $ref: '#/definitions/BookingState'

  /bookings/{idBooking}:
    get:
      summary: Reservation
      description: Request for obtain the information about of idBooking
      parameters:
        - name: idProperty
          in: query
          description: Conditions that must meet the response
          required: true
          type: string
        - name: idBooking
          in: path
          description: Conditions that must meet the response
          required: true
          type: number
        - name: agencySecret
          in: query
          type: string

      tags:
        - MasterBooking
      responses:
        200:
          description:  Return the state of the booking
          schema:
            $ref: '#/definitions/BookingState'
    put:
      summary: Reservation
      description: Request for modify the information about of idBooking
      parameters:
        - name: idProperty
          in: query
          description: Conditions that must meet the response
          required: true
          type: string
        - name: idBooking
          in: path
          description: Conditions that must meet the response
          required: true
          type: number
        - name: booking
          in: body
          required: true
          schema:
            $ref: '#/definitions/BookingState'
        - name: agencySecret
          in: query
          type: string

      tags:
        - MasterBooking
      responses:
        200:
          description: Return the state of the booking
          schema:
            $ref: '#/definitions/BookingState'

    delete:
      summary: Delete reservation
      parameters:
        - name: idBooking
          in: path
          description: Conditions that must meet the response
          required: true
          type: number
        - name: idProperty
          in: query
          description: Conditions that must meet the response
          required: true
          type: string
        - name: agencySecret
          in: query
          type: string
      tags:
        - MasterBooking
      responses:
        200:
          description: Return the new status of the booking
          schema:
            $ref: '#/definitions/BookingState'

definitions:
  Info:
    properties:
      name:
        type: string
        description: Client name
      shortDescription:
        type: string
      longDescription:
        type: string
      multimedia:
        type: array
        items:
          $ref: '#/definitions/MultimediaItem'
        description: array of multimedia items 
      openDate:
        type: string
        description: First open day. 
        format: 'YYYY-MM-DD'
      closeDate:
        type: string
        description: First closed day.
        format: 'YYYY-MM-DD'
      taxes:
        type: array
        items:
          $ref: '#/definitions/Tax'
      bankInfo:
        $ref: '#/definitions/BankInfo'
      bookingConditions:
        type: string
        description: Contract legal terms
      privacyPolicy:
        type: string
        description: Privacy legal terms
      products:
        type: array
        items:
          $ref: "#/definitions/Product"
        description: array of Products
      features:
        type: array
        description: array of Features that apply to all rates of all products of the property
        items:
          $ref: '#/definitions/Feature'
      geoPosition:
        $ref: '#/definitions/Geoposition'

  Tax:
    properties:
      taxType:
        type: string
        enum:
          - VAT
          - TT
      taxName:
        type: string
        description: VAT
      includedInPrices:
        type: boolean
      ammount:
        type: number

  Geoposition:
    properties:
      lat:
        type: number
      long:
        type: number

  BankInfo:
    properties:
      iban:
        type: string
        description: IBAN code
      bic:
        type: string
        description: BIC code
      bankAgencyName:
        type: string
        description: Agency code
      bankName:
        type: string
        description: Bank Name
      beneficiary:
        type: string
        description: Beneficiary

  Feature:
    properties:
      idFeature:
        type: string
        description: Id Feature 
        example: 'dog'
        description: Uniquie id identifying a feature.
      name:
        type: string
      category:
        type: string
      shortDescription:
        type: string
      longDescription:
        type: string
      multimedia:
        type: array
        items:
          $ref: '#/definitions/MultimediaItem'
        description: array of multimedia items      

  Product:
    properties:
      IdProduct:
        type: integer
        description: Id Product 
      name:
        type: string
        description: Name of the product
      shortDescription:
        type: string
        description: Description of the product
      longDescription:
        type: string
        description: Description of the product
      features:
        type: array
        description: array of Features that apply to all the rates of the product
        items:
          $ref: '#/definitions/Feature'

      multimedia:
        type: array
        items:
          $ref: '#/definitions/MultimediaItem'
        description: array of multimedia items
      m2:
        type: number
        description: square meters
      floor:
        type: number
        description: floor number
      rooms:
        type: number
        description: number of rooms
      bedrooms:
        type: number
        description: number of bedrooms
      bathrooms:
        type: number
        description: number of bathrooms
      toilets:
        type: number
        description: number of toilets
      elevator:
        type: boolean
        description: there is any elevator
      hoursCleanning:
        type: number
        description: hours of cleanning
      beds:
        type: array
        description: array of idBedType's
        items:
          $ref: '#/definitions/BedType'
      rates:
        type: array
        description: array of parameters
        items:
          $ref: '#/definitions/Rate'

  BedType:
    properties:
      idBedType:
        type: integer
        description: Id bed type
      name:
        type: string
        description: Name of bed type
      multimedia:
        type: array
        items:
          $ref: '#/definitions/MultimediaItem'
        description: Images array of bed type
      capacityOptions:
        type: array
        items:
          $ref: '#/definitions/BedCapacityOption'

  BedCapacityOption:
    type: array
    items:
      $ref: '#/definitions/BedCapacityOptionItem'

  BedCapacityOptionItem:
    properties:
      minAge: 
        type: number
        description: minimum age
      maxAge: 
        type: number
        description: maximum age

  Rate:
    properties:
      idRate:
        type: integer
        description: Id Rate
      idProduct:
        type: integer
        description: Id Product 
      name:
        type: string
        description: Title
      shortDescription:
        type: string
        description: Short description
      longDescription:
        type: string
        description: Long description
      features:
        type: array
        description: array of idFeature
        items:
          $ref: '#/definitions/Feature'

  MultimediaItem:
    properties:
      type:
        type: string
        enum:
          - Image
          - Video
      url:
        type: string
        description: Image source
      description:
        type: string
        description: Image Id

      alternativeFormats:
        type: array
        items:
          $ref: '#/definitions/MultimediaItemFormat'

  MultimediaItemFormat:
    properties:
      format:
        type: string
      url:
        type: string

  Availability:
    properties:
      firstReservableDate:
        type: string
        description: Date base to search
        format: 'YYYY-MM-DD'
      matrix:
        type: array
        items:
          type: integer
        description: |
          Each integer in the array represents a possible checkin day. The first day matrix[0] in the array is the firstReservableDate, matrix[1] is firstReservableDate +1 and so on. The integer o f a specific date in the array, represents the posssible checkout dates given the checkin. The LSB is one if a stay of one dey is possible. the second LSB is one if a stay of two days is possible and so on.

  Budget:
    properties:
      checkin:
        type: string
        format: date
        description: Checkin date format (YYYY-MM-DD)
      checkout:
        type: string
        format: date
        description: Checkout date format (YYYY-MM-DD)
      idProduct: 
        type: string
        description: Id Product
      idRate: 
        type: string
        description: Id Rate
      price:
        type: number

  Booking:
    properties:
      client:
        type: integer
        description: Id Client 
      language:
        type: string
        description: Language
      referrer:
        type: string
        description: Referrer
      agency:
        type: string
      idProduct:
        type: string
      idRate:
        type: string
        description: Id Rate 
      checkin:
        type: string
        description: Checkin date. Format date  (YYYY-MM-DD)
      checkout:
        type: string
        description: Checkout date. Format date  (YYYY-MM-DD)
      comments:
        type: string
      params:
        type: array
        items:
          $ref: '#/definitions/ParamResponse'
        description: Array of params selected by the user
      client:
        $ref: '#/definitions/Person'
      companions:
        type: array
        items:
          $ref: '#/definitions/Person'
      vehicles:
        type: array
        items:
          $ref: '#/definitions/Vehicle'
        description: Array of vehicles
      creditCardInfo:
        $ref: '#/definitions/CreditCardInfo'
      paymentMethod:
        type: string
        description: Payment Method

      totalAmmount:
        type: number
        description: Value for checking with the server.
      downPayment:
        type: number
        description: Down payment

  Error:
    properties:
      code:
        type: integer
        description: Error code

  BookingState:
    properties:
      idBooking: 
        type: string
      booking:
        $ref: '#/definitions/Booking'
      bookingStatus:
        type: string

  BookingForm:
    properties:
      params:
        type: array
        items:
          $ref: '#/definitions/BookingFormParam'

      constrains:
        type: array
        items:
          $ref: '#/definitions/BookingFormConstrain'

  BookingFormParam:
    properties:
      idParam:
        type: string
      label:
        type: string
      section:
        type: string
      type:
        type: string
        enum:
          - 'QuantityConcep'
          - 'OptionsConcep'
          - 'BooleanConcep'
          - 'Insurance'
      visible:
        type: string
        description: |
          javacript returning tru if this param should be visible
          You can use the paramId's of the form  as variables.
        example: 'childs>0'
      default:
        type: string
      constrains:
        type: array
        items:
          $ref: '#/definitions/BookingFormConstrain'
      QuantityConcepParams:
          $ref: '#/definitions/BookingFormParamQuantityConcep'
      OptionsConcepParams:
          $ref: '#/definitions/BookingFormParamOptionsConcep'
      BooleanConcepParams:
          $ref: '#/definitions/BookingFormParamBooleanConcep' 
      InsuranceParams:
          $ref: '#/definitions/BookingFormParamInsurance' 
          
  BookingFormParamQuantityConcep:
    properties:
      unitPrice:
        type: number
      min:
        type: integer
      max:
        type: integer

  BookingFormParamOptionsConcep: 
    properties:
      options:
        type: array
        items:
          $ref: '#/definitions/BookingFormParamOptionsConcepOption'



  BookingFormParamOptionsConcepOption:
    properties:
      idOption:
        type: string
      label:
        type: string
      price:
        type: number

  BookingFormParamBooleanConcep:
    properties:
      unitPrice:
        type: number

  BookingFormConstrain:
    properties:
      condition:
        type: string
        description: |
          javascript code that returns true if valid and false if invalid. 
          You can use the paramId as variables to calculate the constrain.
        example: 'adults + childs > 6'
      errMsg:
        type: string
        example: 'Total number of persons is limited to 6'

  BookingFormParamInsurance:
    properties:
      chargeType:
        type: string
        description: The pricing type of insurance (percentage -PER- or scaled prices -ESC-)
        default: PER
        enum:
          - 'PER'
          - 'ESC'
      minAdvDays:
        type: integer
        description: Minimum days in advance to purchase cancellation insurance.
      min:
        type: number
        description: In case of percentage charge type, minimun amount to purchase cancellation insurance.
      percentage:
        type: integer
        description: In case of percentage charge type, percentage of total amount to calculate the insurance price.  
      scaledPricesParams:
        type: array
        description: In case of scaled prices charge type, array of conditions of the scale.
        items:
          $ref: '#/definitions/scaledPrices'

  scaledPrices:
    properties:
        upTo:
          type: number
        price:
          type: number

  Person:
    properties:
      firstName:
        type: string
        description: First Name
      lastName:
        type: string
        description: Last Name
      secondLastName:
        type: string
        description: Second Last Name
      middleName:
        type: string
        description: Middle Name
      birthdate:
        type: string
        format: date
        description: Birhdate's date 
        format: 'YYYY-MM-DD' 
      address:
        type: string
        description: Address
      city:
        type: string
        description: City
      zip:
        type: string
        description: Postal code
      state:
        type: string
        description: State
      country: 
        type: string
        description: Country
      idDocumentType:
        type: string
        enum:
          - 'P'
          - 'ES-ID'
          - 'ES-X'
          - 'IT-ID'
          - 'EU-X'
          - 'OTHER-ID'
        description: P (Passport), ES-ID (Spanish ID card), IT-ID (Italian Identity card), ES-X (Spanish residence permit), EU-X (EU residence permit), OTHER-ID (Other ID Card)
      idDocument:
        type: string
        description: number of document
      phone:
        type: string
        description: phone
      email:
        type: string
        description: email

  Vehicle:
    properties:
      Plate:
        type: string
        description: Plate of the vehicle
      brand:
        type: string
        description: brand of the vehicle
      model:
        type: string
        description: model of the vehicle
      color:
        type: string
        description: color of the vehicle

  ParamResponse:
    properties:
      idParam:
        type: string
        description: Id param 
      value:
        type: string

  CreditCardInfo:
    properties:
      ccNumber: 
        type: string
        description: cc number
      expirationDate:
        type: string
        format: 'YYYY-MM-DD'
        description: expiration date of credit card
      cvc:
        type: string
        description: card security code of credit card
      cardHolderName:
        type: string

